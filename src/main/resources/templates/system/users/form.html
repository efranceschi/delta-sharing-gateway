<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <th:block th:replace="~{layout :: layout(~{::title}, ~{::content})}">
        <title th:text="${isEdit ? 'Edit User' : 'Create User'}">User Form</title>
        
        <th:block th:fragment="content">
            <!-- Breadcrumb -->
            <nav class="db-breadcrumb">
                <div class="db-breadcrumb-item">
                    <a href="/"><i class="fas fa-home"></i> Home</a>
                </div>
                <span class="db-breadcrumb-separator">›</span>
                <div class="db-breadcrumb-item">
                    <a href="/system/users">Users</a>
                </div>
                <span class="db-breadcrumb-separator">›</span>
                <div class="db-breadcrumb-item">
                    <span class="db-breadcrumb-current" th:text="${isEdit ? 'Edit' : 'Create'}">Form</span>
                </div>
            </nav>
            
            <!-- Top Bar -->
            <header class="db-topbar">
                <div class="db-topbar-left">
                    <h1 class="db-topbar-title" th:text="${isEdit ? 'Edit User' : 'Create User'}">User Form</h1>
                </div>
            </header>
            
            <!-- Content -->
            <div class="db-content" style="background: #F9FAFB; padding: 24px;">
                <div style="max-width: 800px;">
                    <!-- Error Alert -->
                    <div th:if="${errorMessage}" class="db-alert db-alert-error" style="margin-bottom: 24px;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span th:text="${errorMessage}">Error</span>
                    </div>
                    
                    <!-- Form Card -->
                    <div class="db-card">
                        <form th:action="${isEdit ? '/system/users/' + user.id : '/system/users'}" 
                              method="post" 
                              th:object="${user}">
                            
                            <div class="db-form-grid">
                                <!-- Username -->
                                <div class="db-form-group">
                                    <label class="db-form-label" for="username">
                                        Username <span style="color: #EF4444;">*</span>
                                    </label>
                                    <input type="text" 
                                           id="username" 
                                           th:field="*{username}" 
                                           class="db-form-input"
                                           required>
                                    <div th:if="${#fields.hasErrors('username')}" class="db-form-error">
                                        <span th:errors="*{username}">Error</span>
                                    </div>
                                </div>
                                
                                <!-- Password -->
                                <div class="db-form-group">
                                    <label class="db-form-label" for="password">
                                        Password <span th:if="${!isEdit}" style="color: #EF4444;">*</span>
                                    </label>
                                    <input type="password" 
                                           id="password" 
                                           th:field="*{password}" 
                                           class="db-form-input"
                                           th:placeholder="${isEdit ? 'Leave empty to keep current password' : 'Enter password'}"
                                           th:required="${!isEdit}">
                                    <div th:if="${#fields.hasErrors('password')}" class="db-form-error">
                                        <span th:errors="*{password}">Error</span>
                                    </div>
                                    <small th:if="${isEdit}" style="color: #2563EB; display: block; margin-top: 4px;">
                                        <i class="fas fa-info-circle"></i>
                                        Leave this field empty if you don't want to change the current password
                                    </small>
                                    <small th:if="${!isEdit}" style="color: #6B7280; display: block; margin-top: 4px;">
                                        Password must be at least 8 characters long
                                    </small>
                                </div>
                                
                                <!-- Full Name -->
                                <div class="db-form-group">
                                    <label class="db-form-label" for="fullName">Full Name</label>
                                    <input type="text" 
                                           id="fullName" 
                                           th:field="*{fullName}" 
                                           class="db-form-input">
                                    <div th:if="${#fields.hasErrors('fullName')}" class="db-form-error">
                                        <span th:errors="*{fullName}">Error</span>
                                    </div>
                                </div>
                                
                                <!-- Email -->
                                <div class="db-form-group">
                                    <label class="db-form-label" for="email">Email</label>
                                    <input type="email" 
                                           id="email" 
                                           th:field="*{email}" 
                                           class="db-form-input">
                                    <div th:if="${#fields.hasErrors('email')}" class="db-form-error">
                                        <span th:errors="*{email}">Error</span>
                                    </div>
                                </div>
                                
                                <!-- Role -->
                                <div class="db-form-group">
                                    <label class="db-form-label" for="role">Role</label>
                                    <select id="role" th:field="*{role}" class="db-form-input">
                                        <option value="USER">USER</option>
                                        <option value="ADMIN">ADMIN</option>
                                    </select>
                                </div>
                                
                                <!-- Enable UI -->
                                <div class="db-form-group">
                                    <label class="db-form-checkbox">
                                        <input type="checkbox" th:field="*{enabled}" class="db-checkbox-input">
                                        <span class="db-checkbox-label">Enable UI</span>
                                    </label>
                                    <small style="color: #6B7280; display: block; margin-top: 4px;">
                                        User can login to web interface
                                    </small>
                                </div>
                                
                                <!-- Enable API -->
                                <div class="db-form-group">
                                    <label class="db-form-checkbox">
                                        <input type="checkbox" 
                                               th:field="*{active}" 
                                               class="db-checkbox-input">
                                        <span class="db-checkbox-label">Enable API</span>
                                    </label>
                                    <small style="color: #6B7280; display: block; margin-top: 4px;">
                                        User can access APIs with token
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Form Actions -->
                            <div class="db-form-actions" style="margin-top: 32px;">
                                <button type="submit" class="db-btn db-btn-primary">
                                    <i class="fas fa-save"></i>
                                    <span th:text="${isEdit ? 'Update User' : 'Create User'}">Save</span>
                                </button>
                                <button type="button" class="db-btn db-btn-secondary" onclick="window.location.href='/system/users'">
                                    <i class="fas fa-times"></i>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </th:block>
    </th:block>
</body>
</html>

