<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchy - Delta Sharing OnPrem</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî∑</text></svg>">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar with Hierarchy Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üî∑ Delta Sharing OnPrem</h1>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <a href="/" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                </div>
                
                <!-- Hierarchical Management Navigation -->
                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    
                    <!-- Level 1: Shares -->
                    <div th:each="share : ${shares}" class="nav-hierarchy">
                        <a th:href="@{/hierarchy/share/{id}(id=${share.id})}" 
                           class="nav-link nav-level-1"
                           th:classappend="${viewLevel == 'schemas' && share.id == (share != null ? share.id : null)} ? 'active' : ''">
                            <span class="nav-icon">üóÇÔ∏è</span>
                            <span th:text="${share.name}">Share</span>
                            <span class="nav-badge" th:text="${share.schemasCount}">0</span>
                        </a>
                        
                        <!-- Level 2: Schemas (shown when share is selected) -->
                        <div th:if="${viewLevel == 'schemas' || viewLevel == 'tables'}" 
                             th:with="currentShare=${share}"
                             class="nav-sublevel">
                            <div th:if="${schemas != null && currentShare.id == (share != null ? share.id : null)}"
                                 th:each="schema : ${schemas}" 
                                 class="nav-hierarchy">
                                <a th:href="@{/hierarchy/share/{shareId}/schema/{schemaId}(shareId=${currentShare.id},schemaId=${schema.id})}" 
                                   class="nav-link nav-level-2"
                                   th:classappend="${viewLevel == 'tables' && schema.id == (schema != null ? schema.id : null)} ? 'active' : ''">
                                    <span class="nav-icon">üìÅ</span>
                                    <span th:text="${schema.name}">Schema</span>
                                    <span class="nav-badge" th:text="${schema.tablesCount}">0</span>
                                </a>
                                
                                <!-- Level 3: Tables (shown when schema is selected) -->
                                <div th:if="${viewLevel == 'tables' && tables != null && schema.id == (schema != null ? schema.id : null)}" 
                                     class="nav-sublevel">
                                    <div th:each="table : ${tables}">
                                        <div class="nav-link nav-level-3">
                                            <span class="nav-icon">üìã</span>
                                            <span th:text="${table.name}">Table</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Quick Actions</div>
                    <a href="/admin/shares/new" class="nav-link">
                        <span class="nav-icon">‚ûï</span>
                        <span>New Share</span>
                    </a>
                    <a href="/admin/schemas/new" class="nav-link">
                        <span class="nav-icon">‚ûï</span>
                        <span>New Schema</span>
                    </a>
                    <a href="/admin/tables/new" class="nav-link">
                        <span class="nav-icon">‚ûï</span>
                        <span>New Table</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">API</div>
                    <a href="/swagger-ui.html" class="nav-link" target="_blank">
                        <span class="nav-icon">üì°</span>
                        <span>API Docs</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="breadcrumb">
                    <a href="/hierarchy">üóÇÔ∏è Shares</a>
                    <span th:if="${share != null}">
                        / <a th:href="@{/hierarchy/share/{id}(id=${share.id})}" th:text="${share.name}">Share</a>
                    </span>
                    <span th:if="${schema != null}">
                        / <span th:text="${schema.name}">Schema</span>
                    </span>
                </div>
                <div class="topbar-actions">
                    <a th:if="${viewLevel == 'shares'}" href="/admin/shares/new" class="btn btn-primary btn-sm">‚ûï New Share</a>
                    <a th:if="${viewLevel == 'schemas'}" th:href="@{/admin/schemas/new}" class="btn btn-primary btn-sm">‚ûï New Schema</a>
                    <a th:if="${viewLevel == 'tables'}" th:href="@{/admin/tables/new}" class="btn btn-primary btn-sm">‚ûï New Table</a>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Level 1: Shares View -->
                <div th:if="${viewLevel == 'shares'}">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">All Shares</h3>
                            <span class="badge badge-info" th:text="${#lists.size(shares)} + ' shares'">0 shares</span>
                        </div>
                        <div class="card-body">
                            <div class="hierarchy-grid">
                                <div th:each="share : ${shares}" class="hierarchy-card" th:onclick="'window.location=\'/hierarchy/share/' + ${share.id} + '\''">
                                    <div class="hierarchy-card-icon">üóÇÔ∏è</div>
                                    <h3 th:text="${share.name}">Share Name</h3>
                                    <p th:text="${share.description}">Description</p>
                                    <div class="hierarchy-card-meta">
                                        <span class="badge badge-info" th:text="${share.schemasCount} + ' schemas'">0 schemas</span>
                                        <span th:if="${share.active}" class="badge badge-success">Active</span>
                                    </div>
                                    <div class="hierarchy-card-actions">
                                        <a th:href="@{/admin/shares/{id}/edit(id=${share.id})}" class="btn btn-sm btn-secondary" onclick="event.stopPropagation()">‚úèÔ∏è Edit</a>
                                        <a th:href="@{/hierarchy/share/{id}(id=${share.id})}" class="btn btn-sm btn-primary">View ‚Üí</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Level 2: Schemas View -->
                <div th:if="${viewLevel == 'schemas'}">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Schemas in <span th:text="${share.name}">Share</span></h3>
                            <span class="badge badge-info" th:text="${#lists.size(schemas)} + ' schemas'">0 schemas</span>
                        </div>
                        <div class="card-body">
                            <div class="hierarchy-grid">
                                <div th:each="schema : ${schemas}" class="hierarchy-card" th:onclick="'window.location=\'/hierarchy/share/' + ${share.id} + '/schema/' + ${schema.id} + '\''">
                                    <div class="hierarchy-card-icon">üìÅ</div>
                                    <h3 th:text="${schema.name}">Schema Name</h3>
                                    <p th:text="${schema.description}">Description</p>
                                    <div class="hierarchy-card-meta">
                                        <span class="badge badge-success" th:text="${schema.tablesCount} + ' tables'">0 tables</span>
                                    </div>
                                    <div class="hierarchy-card-actions">
                                        <a th:href="@{/admin/schemas/{id}/edit(id=${schema.id})}" class="btn btn-sm btn-secondary" onclick="event.stopPropagation()">‚úèÔ∏è Edit</a>
                                        <a th:href="@{/hierarchy/share/{shareId}/schema/{schemaId}(shareId=${share.id},schemaId=${schema.id})}" class="btn btn-sm btn-primary">View ‚Üí</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Level 3: Tables View -->
                <div th:if="${viewLevel == 'tables'}">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Tables in <span th:text="${schema.name}">Schema</span></h3>
                            <span class="badge badge-info" th:text="${#lists.size(tables)} + ' tables'">0 tables</span>
                        </div>
                        <div class="card-body">
                            <div class="hierarchy-grid">
                                <div th:each="table : ${tables}" class="hierarchy-card">
                                    <div class="hierarchy-card-icon">üìã</div>
                                    <h3 th:text="${table.name}">Table Name</h3>
                                    <p th:text="${table.description}">Description</p>
                                    <div class="hierarchy-card-meta">
                                        <span class="badge badge-info" th:text="${table.format}">parquet</span>
                                        <span th:if="${table.shareAsView}" class="badge badge-warning">View</span>
                                    </div>
                                    <div class="hierarchy-card-details">
                                        <small><strong>Location:</strong> <span th:text="${table.location}">location</span></small>
                                    </div>
                                    <div class="hierarchy-card-actions">
                                        <a th:href="@{/admin/tables/{id}/edit(id=${table.id})}" class="btn btn-sm btn-secondary">‚úèÔ∏è Edit</a>
                                        <a th:href="@{/admin/tables/{id}/delete(id=${table.id})}" class="btn btn-sm btn-danger" onclick="return confirm('Delete this table?')">üóëÔ∏è Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
